[Unit]
Description=HAL-O-SWARM Agent - Local LLM Session Manager
Documentation=https://github.com/bldg-7/hal-o-swarm/blob/main/docs/DEPLOYMENT.md
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=hal-agent
Group=hal-agent
WorkingDirectory=/opt/hal-o-swarm

# Environment and configuration
EnvironmentFile=/etc/hal-o-swarm/agent.env
ExecStart=/usr/local/bin/hal-agent \
  --config /etc/hal-o-swarm/agent.config.json

# Process management
Restart=on-failure
RestartSec=10
StartLimitInterval=300
StartLimitBurst=5

# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=yes
ReadWritePaths=/var/lib/hal-o-swarm /var/log/hal-o-swarm /home

# Resource limits
LimitNOFILE=65536
LimitNPROC=4096
MemoryMax=4G
CPUQuota=90%

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=hal-agent

# Graceful shutdown
TimeoutStopSec=30
KillMode=mixed
KillSignal=SIGTERM

[Install]
WantedBy=multi-user.target
